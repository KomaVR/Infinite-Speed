<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Editor with Splitting</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            text-align: center;
        }
        #video-container {
            margin-top: 20px;
        }
        #timeline {
            width: 100%;
            margin: 10px 0;
        }
        #controls {
            margin-top: 10px;
        }
        input[type="number"] {
            width: 150px;
        }
    </style>
</head>
<body>
    <h1>Video Editor with Splitting</h1>
    <input type="file" id="videoUpload" accept="video/*">
    <div id="video-container">
        <video id="video" width="600" controls></video>
        <input type="range" id="timeline" min="0" max="100" step="0.1">
    </div>
    <div id="controls">
        <label for="speed">Speed:</label>
        <input type="number" id="speed" value="1" step="0.000001" min="0.000001">
        <button id="setSpeed">Set Speed</button>
        <br><br>
        <label for="startTime">Start Time:</label>
        <input type="number" id="startTime" step="0.01" min="0">
        <label for="endTime">End Time:</label>
        <input type="number" id="endTime" step="0.01" min="0">
        <button id="split">Export Split</button>
    </div>
    <div id="downloads" style="margin-top: 20px;"></div>

    <script>
        const videoUpload = document.getElementById('videoUpload');
        const video = document.getElementById('video');
        const timeline = document.getElementById('timeline');
        const speedInput = document.getElementById('speed');
        const setSpeedButton = document.getElementById('setSpeed');
        const splitButton = document.getElementById('split');
        const startTimeInput = document.getElementById('startTime');
        const endTimeInput = document.getElementById('endTime');
        const downloads = document.getElementById('downloads');

        let videoBlob = null;
        let videoDuration = 0;

        // Load video when file is uploaded
        videoUpload.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                const url = URL.createObjectURL(file);
                video.src = url;
                videoBlob = file;
                video.load();
                video.addEventListener('loadedmetadata', () => {
                    videoDuration = video.duration;
                    timeline.max = video.duration;
                    endTimeInput.max = video.duration;
                    startTimeInput.max = video.duration;
                });
            }
        });

        // Sync timeline with video progress
        video.addEventListener('timeupdate', () => {
            timeline.value = video.currentTime;
        });

        // Seek video when timeline changes
        timeline.addEventListener('input', () => {
            video.currentTime = timeline.value;
        });

        // Set video speed
        setSpeedButton.addEventListener('click', () => {
            const speed = parseFloat(speedInput.value);
            if (speed > 0) {
                video.playbackRate = speed;
            } else {
                alert('Speed must be greater than 0');
            }
        });

        // Export the split video
        splitButton.addEventListener('click', () => {
            const startTime = parseFloat(startTimeInput.value);
            const endTime = parseFloat(endTimeInput.value);

            if (isNaN(startTime) || isNaN(endTime) || startTime >= endTime || endTime > videoDuration) {
                alert('Invalid start or end time');
                return;
            }

            if (videoBlob) {
                const fileURL = URL.createObjectURL(videoBlob);
                const videoElement = document.createElement('video');
                videoElement.src = fileURL;
                videoElement.currentTime = startTime;

                // Extract the specified range
                videoElement.addEventListener('seeked', () => {
                    const captureStream = videoElement.captureStream();
                    const mediaRecorder = new MediaRecorder(captureStream);
                    const chunks = [];

                    mediaRecorder.ondataavailable = (e) => chunks.push(e.data);
                    mediaRecorder.onstop = () => {
                        const blob = new Blob(chunks, { type: 'video/mp4' });
                        const downloadLink = document.createElement('a');
                        downloadLink.href = URL.createObjectURL(blob);
                        downloadLink.download = `split_${startTime.toFixed(2)}-${endTime.toFixed(2)}.mp4`;
                        downloadLink.textContent = `Download split (${startTime.toFixed(2)}s - ${endTime.toFixed(2)}s)`;
                        downloads.appendChild(downloadLink);
                        downloads.appendChild(document.createElement('br'));
                    };

                    mediaRecorder.start();
                    setTimeout(() => {
                        mediaRecorder.stop();
                    }, (endTime - startTime) * 1000); // Record duration
                });
            } else {
                alert('No video loaded to split.');
            }
        });
    </script>
</body>
</html>
